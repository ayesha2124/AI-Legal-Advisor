<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Document Query | Legal-E</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    body {
      background: linear-gradient(to bottom right, #fffbea, #fceabb);
    }
    .nav-link:hover {
      color: #92400e;
    }
    .card {
      background-color: #fff;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .file-drop-box {
      border: 2px dashed #e2e8f0;
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      background: #fefce8;
      position: relative;
    }
    .file-drop-box:hover {
      background: #fef9c3;
      border-color: #facc15;
      cursor: pointer;
    }
    .file-drop-box input[type="file"] {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }
  </style>
</head>
<body class="min-h-screen">
  <nav class="flex justify-between items-center px-8 py-6 bg-yellow-100 shadow-md sticky top-0 z-50">
<<<<<<< HEAD
    <h1 class="text-3xl font-bold text-yellow-800">⚖️ Legal-E</h1>
=======
    <h1 class="text-3xl font-bold text-yellow-800">⚖️ AI-Powered Legal Advisor</h1>
>>>>>>> 72f408b (final)
    <ul class="flex space-x-8 text-lg font-medium text-yellow-900">
      <li><a class="nav-link" href="/">Home</a></li>
      <li><a class="nav-link" href="/summarization">Summarization</a></li>
    </ul>
  </nav>

  <main class="py-20 px-6">
    <h2 class="text-4xl font-extrabold text-center text-gray-800 mb-6">Query Your Legal Document</h2>
    <p class="mb-10 text-lg text-center text-gray-600 max-w-3xl mx-auto">
      Upload a legal document and ask questions about its clauses, obligations, or terms. Get answers instantly below.
    </p>

    <div class="max-w-5xl mx-auto w-full">
      <div class="card p-10">
        <!-- File Upload -->
        <div class="mb-8">
          <label class="block text-gray-700 font-semibold mb-3 text-lg">Choose File:</label>
          <div class="file-drop-box">
            <input type="file" id="file" accept=".pdf,.docx" />
            <p class="text-lg text-yellow-900 font-semibold">Click or Drop your legal file here</p>
            <p class="text-gray-500 mt-1 text-sm">(Supported formats: .pdf, .docx)</p>
            <p id="filename" class="mt-3 text-sm text-gray-700 font-medium"></p> <!-- Show selected file -->
          </div>
          <button id="uploadBtn" class="mt-4 bg-yellow-600 text-white px-6 py-2 rounded hover:bg-yellow-700 hover:shadow-lg">
            Upload Document
          </button>
        </div>

        <!-- Question Input -->
        <div class="flex items-center border rounded-lg px-4 py-2 bg-white shadow-md">
          <input type="text" id="question" placeholder="Type your question here..." class="flex-grow outline-none text-base px-2 py-2" required />
          <button id="askBtn" class="text-white bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-full ml-2">
            <i class="ph ph-paper-plane text-xl"></i>
          </button>
        </div>
      </div>

      <!-- Answer Box -->
      <div class="mt-10">
        <h3 class="text-2xl font-bold text-gray-700 mb-3"> Answer:</h3>
        <div id="answer" class="card p-6 text-gray-800 whitespace-pre-line min-h-[150px] text-base leading-relaxed"></div>
      </div>
    </div>
  </main>

  <script>
  let fileUploaded = false;

  // Show selected file name
  document.getElementById("file").onchange = function () {
    const file = this.files[0];
    document.getElementById("filename").innerText = file ? `Selected: ${file.name}` : "";
  };

  // Upload file
  document.getElementById("uploadBtn").onclick = async () => {
    const fileInput = document.getElementById("file");
    if (!fileInput.files.length) {
      alert("Please choose a file first.");
      return;
    }

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    const res = await fetch("/upload_query_file", {
      method: "POST",
      body: formData
    });

    const result = await res.json();
    if (res.ok) {
      alert(" File uploaded successfully.");
      fileUploaded = true;
    } else {
      alert(" Error: " + result.error);
    }
  };

  // Ask question
  document.getElementById("askBtn").onclick = async () => {
    const question = document.getElementById("question").value.trim();
    if (!fileUploaded) {
      alert("❗ Please upload a document first.");
      return;
    }
    if (!question) {
      alert("Please enter your question.");
      return;
    }

    const answerBox = document.getElementById("answer");
<<<<<<< HEAD
    answerBox.innerText = "⏳ Generating answer, please wait...";
=======
    answerBox.innerText = "Generating answer, please wait...";
>>>>>>> 72f408b (final)

    const res = await fetch("/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question })
    });

    const result = await res.json();
    answerBox.innerText = result.answer || " No answer found.";

    // ✅ Auto-scroll to answer section
    answerBox.scrollIntoView({ behavior: "smooth" });
  };
</script>
</body>
</html>
